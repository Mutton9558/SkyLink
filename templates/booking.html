<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{{url_for('static', filename='img/icon.png')}}" />
    <title>Booking Page</title>
    <style>
        :root {
            --primary: #82C26E;
            /*rgb primary (130, 194, 110)*/
            --secondary: #0A85ED;
            /*rgb secondary (10, 133, 237)*/
            --background-dark: #050418;
            --text-dark-mode: #e8e6fb;
            --background-light: #f0f0f0;
            --text-light-mode: #06041a;
        }

        body {
            font-family: 'Roboto', serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 600px;
            margin: 80px auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            font-weight: bold;
        }

        input[type="text"], input[type="number"], button {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .preset-values {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        #seating-form{
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            position: fixed;
            top: 0;
            left: 0;
        }

        #seats{
            position: relative;
            width: 30rem;
            height: 30rem;
            display: flex;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #closeBtn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            position: absolute;
            right: 0;
            top: 0;
            background: none;
        }


        #column-left-seats, #column-right-seats{
            margin-top: 2.8rem;
            width: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }


        #seating-form #row-left-seats{
            display: flex;
            flex-direction: row;
            float: left;
        }

        .taken{
            background-color: red !important;
            cursor: not-allowed;
            pointer-events: none;
        }

        .disabled{
            background-color: gray !important;
            cursor: not-allowed;
        }

        #row-left-seats .seat-btn, #row-right-seats .seat-btn{
            text-align: center;
            font-size: 12px;
            width: 50px;
            height: 30px;
            border-radius: 10px;
            background-color: greenyellow;
            margin: 0.4rem;
        }

        #row-right-seats {
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
        }

        #seat-form-header{
            position: absolute;
            top: 0;
            left: 35%;
        }
        .header {
            background-color: rgb(224, 221, 221);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: fit-content;
            z-index: 1;
            padding-right: 1rem;
        }

        .header-container{
            display: flex;
            -webkit-box-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            align-items: center;
            padding: 0 80px;
            height: 64px;
            width: 100%;
        }

        .logo{
            position: relative;
            -webkit-box-align: center;
            align-items: center;
            display: flex;
            -webkit-box-pack: start;
            justify-content: flex-start;
            flex: 1 1 0%;
            height: 100%;
        }

        .useful-links{
            -webkit-box-pack: end;
            justify-content: flex-end;
            position: relative;
            display: flex;
            -webkit-box-align: center;
            align-items: center;
            height: 100%;
        }

        .link{
            display: flex;
            text-align: center;
            -webkit-box-align: center;
            align-items: center;
            position: relative;
            height: 100%;
            margin-left: 24px;
        }

        .nav-link{
            display: inline-flex;
            color: var(--text-light-mode);
            text-decoration: none;
        }

        .profile{
            display: inline-block;
            text-align: center;
            -webkit-box-align: center;
            align-self: center;
            position: relative;
            height: 100%;
            margin-left: 24px;
            margin-right: 24px;
            margin-top: 13px;
        }

        .profile-text{
            padding-left: 5px;
            font-family: 'Roboto', serif;
        }

        .dropdown{
            display: none; /* Hide dropdown by default */
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 11;
        }

        .dropdown-content {
            display: flex;
            flex-direction: column;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            text-align: left;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .profile:hover .dropdown {
            display: block; /* Show dropdown on hover */
        }

        body.dark-mode {
            background-color: var(--background-dark);
            color: #ffffff;
        }

        body.dark-mode .header,
        body.dark-mode .dropdown {
            background-color: #333333;
        }

        body.dark-mode p,
        body.dark-mode svg {
            color: var(--text-dark-mode);
        }

        body.dark-mode .dropdown-content :hover {
            background-color: #535353;
        }

        body.dark-mode .container {
            background-color: #1e1e1e;
        }

        body.dark-mode .preset-values {
            background-color: #1e1e1e;
        }

        body.dark-mode input {
            background-color: #333333;
            color: #ffffff;
            border: 1px solid #444444;
        }

        body.dark-mode .seat-btn {
            color: var(--text-light-mode);
        }

        body.dark-mode #seats {
            background-color: #333333;
        }
    </style>    
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <a class="navbar-brand" href="/home">
                    <img src="{{url_for('static', filename='img/logo.png')}}" height="80" alt="SkyLink" href="/">
                </a>
            </div>
            <div class="useful-links">
                {% if email == "skylinkcustomerservice@gmail.com" %}
                    <div class="link">
                        <a class="nav-link" href="/admin">
                            <p>Admin</p>
                        </a>
                    </div>
                {% endif %}
                <div class="link">
                    <a class="nav-link" href="{{ url_for('profile') }}#recent-flight-list-container">
                        <p>Purchases</p>
                    </a>
                </div>
                <div class="link">
                    <a class="nav-link" href="/check-in">
                        <p>Check-in</p>
                    </a>
                </div>
                <div class="link">
                    <a class="nav-link" href="/support">
                        <p>Support</p>
                    </a>
                </div>
                <div class="profile">
                    <a class="nav-link" href="#">
                        <svg
                        xmlns="http://www.w3.org/2000/svg"
                        display="flex"
                        width="25"
                        fill="currentColor"
                        class="bi bi-person-circle"
                        viewBox="0 0 16 16"
                        >
                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                        <path
                            fill-rule="evenodd"
                            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"
                        />
                        </svg>
                        <p class="profile-text">{{ profile_Name }}</p>
                    </a>
                    <div class="dropdown">
                        <div class="dropdown-content">
                            <a href="/profile">Profile</a>
                            <a href="/settings">Settings</a>
                            <a href="/logout">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    {% if tripType == "one-way" %}
        <div class="container">
            <h1>Flight Booking</h1>
            
            <form method="POST" id="form-booking">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                {% with messages = get_flashed_messages() %} 
                    {% if messages %} 
                        {% for msg in messages %}
                        <p style="color: red" id="flashed-msg">*{{ msg }}</p>
                        {% endfor %} 
                    {% endif %} 
                {% endwith %}
                {% for i in range(1, passengerNum+1) %}
                    <h1>Passenger {{ i }}</h1>
                    <div id="booking-form">

                        <label for="first_name">First Name</label>
                        <input type="text" id="first_name" name="first-name-{{ i }}" placeholder="Enter your first name" required>

                        <label for="surname">Surname</label>
                        <input type="text" id="surname" name="surname-{{ i }}" placeholder="Enter your surname" required>

                        <label for="ic_number">IC Number</label>
                        <input type="text" id="ic_number" name="ic-number-{{ i }}" placeholder="Enter your IC number" maxlength="12" required>

                        <label for="phone_number">Phone Number</label>
                        <input type="text" id="phone_number" name="phone-number-{{ i }}" placeholder="Enter your phone number" required>

                        <div class="preset-values">
                            <p><strong>Start Location:</strong> {{ dataList[0]["originLocation"] }}</p>
                            <p><strong>Destination:</strong> {{ dataList[0]["destinationLocation"] }}</p>
                            <p><strong>Departure Time:</strong> {{ dataList[0]["departureTime"]}}</p>
                            <p><strong>Estimated Arrival:</strong> {{ dataList[0]["arrivalTime"]}}</p>
                            <p><strong>Flight Date:</strong> {{ dataList[0]["date"] }}</p>
                            <p><strong>Airline:</strong> {{ dataList[0]["airline"] }}</p>
                            <p><strong>Flight Number:</strong> {{ dataList[0]["flightNumber"] }}</p>
                        </div>

                        <label for="seat_selection">Choose a Seat</label>
                        <div id="wrapper-seat">
                            <button type="button" data-seat-2='{{ quadrant_taken_json | safe }}' data-seat-3='{{ dataList[0]["flightNumber"] }}' id="choose_seat" onclick="showForm(event, this)">
                                Choose Seat
                            </button>
                            <div id="seating-form">
                                <div id="seats">
                                    <h3 id="seat-form-header">Choose your seat:</h3>
                                    <button type="button" id="closeBtn" onclick="closeForm(event)"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAmdJREFUSEu1lr9uE0EQxn+TuKJLn2dA4g2QFQTCsqCgsEBKSQsFD0QRUkQIWYiOBoGUxijwKoCFiSiG+7N33r3dub2NxBXWeXdv/nzzfTMrDB8BtPmJtvqFaDtx3i355vxT9XviCQ3t/2UCSmcRrnoBgWXPjzob3uBADrQoGwtqK4jovCBoslC+rxbq0egycNhMGNkRpLRqUaA5SA2aeuSyLSTQ3JP+RpG3IBfRZiiJQHQFVTEcu7K3ho4E1iq8QPk+qhjhHspL4DHwdyynXMYHwDfgNvADZA56ZZBxWZ17B8yAD8ByjLWB45DuvSROgdeO+z+BE2DTG20/WgBrhBnKtcBS4WNSMJ0sp9RM4FT3zrcI88rZxkHZOm0zvQYeAJ86mM2yRxuJhaYhCCuUc5f51sF+DFyAzATdKTz0ndaopJtJvV72PAXeuE+2wC3gAOQP6P0Kic9js8V3NaFzRRRZAWcghy6bHcgJ6GVJDpMayCDSlTaOOXTrO0e4y47t6bqGqyarjXn8rMm2teFD/Ru0JtWXpIQSkcRQ2zSvIT4XEKV22mj6GOEClRloxOiQXCHRcg2kmwmhnGAOsnGoLEDWoGVyGjKt7b0BNkYDCU6ZWvabkl++nJzqlvkVuAP8Arkr6FV8JWvM+y3zfdVqH42x3JvHBgNUjgR9W9X1levbwQQJwBEWKM+BJ/GQCMmTy3jkepJgodUfXerhLChR/cjozms3peNuYvTXlCmhW6XxSRcZ7nO/2Z0rLYVwUk6IvejqM1oZP8Hm3TWNaN28c1nmLejKiTKB1QVG7XY7MPKf7tWZ8jZB/AM5t/Em43PHggAAAABJRU5ErkJggg=="/></button>
                                    <div id="column-left-seats" class='{{ dataList[0]["flightNumber"] }}'>
                                        {% for i in range(0, 10) %}
                                            <div id="row-left-seats">
                                                {% for j in range(0, 3) %}
                                                    {% set seat_id = i ~ '-' ~ rowDict[j] %}
                                                    <!-- onclick="sendId('{{ seat_id }}')" -->
                                                    {% if seat_id in taken_seats %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats_json | safe }}' data-seat-2='{{ quadrant_taken_json | safe }}' data-seat-3='{{ dataList[0]["flightNumber"] }}'  onclick="processInformation(event, this)" class="seat-btn taken">{{ seat_id }}</button>
                                                    {% else %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats_json | safe }}' data-seat-2='{{ quadrant_taken_json | safe }}' data-seat-3='{{ dataList[0]["flightNumber"] }}' onclick="processInformation(event, this)" class="seat-btn">{{ seat_id }}</button>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div id="column-right-seats" class='{{ dataList[0]["flightNumber"] }}'>
                                        {% for i in range(0, 10) %}
                                            <div id="row-right-seats">
                                                {% for j in range(3, 6) %}
                                                    {% set seat_id = i ~ '-' ~ rowDict[j] %}
                                                    <!-- onclick="sendId('{{ seat_id }}')" -->
                                                    {% if seat_id in taken_seats %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats_json | safe }}' data-seat-2='{{ quadrant_taken_json | safe }}' data-seat-3='{{ dataList[0]["flightNumber"] }}' onclick="processInformation(event, this)" class="seat-btn taken">{{ seat_id }}</button>
                                                    {% else %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats_json | safe }}' data-seat-2='{{ quadrant_taken_json | safe }}' data-seat-3='{{ dataList[0]["flightNumber"] }}' onclick="processInformation(event, this)" class="seat-btn">{{ seat_id }}</button>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="seat-input" class="seat-input" name="chosen-seat">
                            <p id="chosen-seat-text"></p>
                        </div>
                    </div>
                {% endfor %}
                <button type="submit">Submit Booking</button>
            </form>
        </div>
    {% elif tripType == "round-trip" %}
    <div class="container">
        <h1>Flight Booking</h1>
        
        <form method="POST" id="form-booking">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            {% with messages = get_flashed_messages() %} 
                {% if messages %} 
                    {% for msg in messages %}
                    <p style="color: red" id="flashed-msg">*{{ msg }}</p>
                    {% endfor %} 
                {% endif %} 
            {% endwith %}
            {% for i in range(1, passengerNum+1) %}
                <h1>Passenger {{ i }}</h1>
                <div id="booking-form">
                    <label for="first_name">First Name</label>
                    <input type="text" id="first_name" name="first-name-{{ i }}" placeholder="Enter your first name" required>

                    <label for="surname">Surname</label>
                    <input type="text" id="surname" name="surname-{{ i }}" placeholder="Enter your surname" required>

                    <label for="ic_number">IC Number</label>
                    <input type="text" id="ic_number" name="ic-number-{{ i }}" placeholder="Enter your IC number" maxlength="12" required>

                    <label for="phone_number">Phone Number</label>
                    <input type="text" id="phone_number" name="phone-number-{{ i }}" placeholder="Enter your phone number" required>

                    {% for data in dataList %}
                        <div class="preset-values">
                            {% if data == dataList[0] %}
                                <p>Departure Flight</p>
                            {% else %}
                                <p>Return Flight</p>
                            {% endif %}
                            <p><strong>Start Location:</strong> {{ data["originLocation"] }}</p>
                            <p><strong>Destination:</strong> {{ data["destinationLocation"] }}</p>
                            <p><strong>Departure Time:</strong> {{ data["departureTime"]}}</p>
                            <p><strong>Estimated Arrival:</strong> {{ data["arrivalTime"]}}</p>
                            <p><strong>Flight Date:</strong> {{ data["date"] }}</p>
                            <p><strong>Airline:</strong> {{ data["airline"] }}</p>
                            <p><strong>Flight Number:</strong> {{ data["flightNumber"] }}</p>

                            <label for="seat_selection">Choose a Seat</label>
                            <div id="wrapper-seat">
                                {% if data == dataList[0] %}
                                    <button type="button" id="choose_seat" data-seat-2='{{ quadrant_taken_json[0] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick="showForm(event, this)">
                                        Choose Seat
                                    </button>
                                {% else %}
                                    <button type="button" id="choose_seat" data-seat-2='{{ quadrant_taken_json[1] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick="showForm(event, this)">
                                        Choose Seat
                                    </button>
                                {% endif %}
                                <div id="seating-form">
                                    <div id="seats">
                                        <h3 id="seat-form-header">Choose your seat:</h3>
                                        <button type="button" id="closeBtn" onclick="closeForm(event)"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAmdJREFUSEu1lr9uE0EQxn+TuKJLn2dA4g2QFQTCsqCgsEBKSQsFD0QRUkQIWYiOBoGUxijwKoCFiSiG+7N33r3dub2NxBXWeXdv/nzzfTMrDB8BtPmJtvqFaDtx3i355vxT9XviCQ3t/2UCSmcRrnoBgWXPjzob3uBADrQoGwtqK4jovCBoslC+rxbq0egycNhMGNkRpLRqUaA5SA2aeuSyLSTQ3JP+RpG3IBfRZiiJQHQFVTEcu7K3ho4E1iq8QPk+qhjhHspL4DHwdyynXMYHwDfgNvADZA56ZZBxWZ17B8yAD8ByjLWB45DuvSROgdeO+z+BE2DTG20/WgBrhBnKtcBS4WNSMJ0sp9RM4FT3zrcI88rZxkHZOm0zvQYeAJ86mM2yRxuJhaYhCCuUc5f51sF+DFyAzATdKTz0ndaopJtJvV72PAXeuE+2wC3gAOQP6P0Kic9js8V3NaFzRRRZAWcghy6bHcgJ6GVJDpMayCDSlTaOOXTrO0e4y47t6bqGqyarjXn8rMm2teFD/Ru0JtWXpIQSkcRQ2zSvIT4XEKV22mj6GOEClRloxOiQXCHRcg2kmwmhnGAOsnGoLEDWoGVyGjKt7b0BNkYDCU6ZWvabkl++nJzqlvkVuAP8Arkr6FV8JWvM+y3zfdVqH42x3JvHBgNUjgR9W9X1levbwQQJwBEWKM+BJ/GQCMmTy3jkepJgodUfXerhLChR/cjozms3peNuYvTXlCmhW6XxSRcZ7nO/2Z0rLYVwUk6IvejqM1oZP8Hm3TWNaN28c1nmLejKiTKB1QVG7XY7MPKf7tWZ8jZB/AM5t/Em43PHggAAAABJRU5ErkJggg=="/></button>
                                        <div id="column-left-seats" class='{{ data["flightNumber"] }}'>
                                            {% for i in range(0, 10) %}
                                                <div id="row-left-seats">
                                                    {% for j in range(0, 3) %}
                                                        {% set seat_id = i ~ '-' ~ rowDict[j] %}
                                                        <!-- onclick="sendId('{{ seat_id }}')" -->
                                                        {% if seat_id in (taken_seats[0] if data == dataList[0] else taken_seats[1]) %}
                                                            {% if data == dataList[0] %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[0] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[0] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn taken">{{ seat_id }}</button>
                                                            {% else %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[1] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[1] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn taken">{{ seat_id }}</button>
                                                            {% endif %}
                                                        {% else %}
                                                            {% if data == dataList[0] %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[0] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[0] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn">{{ seat_id }}</button>
                                                            {% else %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[1] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[1] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn">{{ seat_id }}</button>
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            {% endfor %}
                                        </div>
                                        <div id="column-right-seats" class='{{ data["flightNumber"] }}'>
                                            {% for i in range(0, 10) %}
                                                <div id="row-right-seats">
                                                    {% for j in range(3, 6) %}
                                                        {% set seat_id = i ~ '-' ~ rowDict[j] %}
                                                        <!-- onclick="sendId('{{ seat_id }}')" -->
                                                        {% if seat_id in (taken_seats[0] if data == dataList[0] else taken_seats[1]) %}
                                                            {% if data == dataList[0] %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[0] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[0] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}'  onclick='processInformation(event, this)' class="seat-btn taken">{{ seat_id }}</button>
                                                            {% else %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[1] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[1] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn taken">{{ seat_id }}</button>
                                                            {% endif %}
                                                        {% else %}
                                                            {% if data == dataList[0] %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[0] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[0] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn">{{ seat_id }}</button>
                                                            {% else %}
                                                                <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[1] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[1] | tojson | safe }}' data-seat-3='{{ data["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn">{{ seat_id }}</button>
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="seat-input" class="seat-input" name="chosen-seat">
                                <p id="chosen-seat-text"></p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
            <button type="submit">Submit Booking</button>
        </form>
    </div>
{% elif tripType == "multi-city" %}
    <div class="container">
        <h1>Flight Booking</h1>
        <form method="POST" id="form-booking">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            {% with messages = get_flashed_messages() %} 
                {% if messages %} 
                    {% for msg in messages %}
                    <p style="color: red" id="flashed-msg">*{{ msg }}</p>
                    {% endfor %} 
                {% endif %} 
            {% endwith %}
            {% for i in range(1, passengerNum+1) %}
            <h1>Passenger {{ i }}</h1>
            <div id="booking-form">
                <label for="first_name">First Name</label>
                <input type="text" id="first_name" name="first-name-{{ i }}" placeholder="Enter your first name" required>

                <label for="surname">Surname</label>
                <input type="text" id="surname" name="surname-{{ i }}" placeholder="Enter your surname" required>

                <label for="ic_number">IC Number</label>
                <input type="text" id="ic_number" name="ic-number-{{ i }}" placeholder="Enter your IC number" maxlength="12" required>

                <label for="phone_number">Phone Number</label>
                <input type="text" id="phone_number" name="phone-number-{{ i }}" placeholder="Enter your phone number" required>

                {% for data in range (0, dataList|length) %}
                    <div class="preset-values">
                        <p><strong>Start Location:</strong> {{ dataList[data]["originLocation"] }}</p>
                        <p><strong>Destination:</strong> {{ dataList[data]["destinationLocation"] }}</p>
                        <p><strong>Departure Time:</strong> {{ dataList[data]["departureTime"]}}</p>
                        <p><strong>Estimated Arrival:</strong> {{ dataList[data]["arrivalTime"]}}</p>
                        <p><strong>Flight Date:</strong> {{ dataList[data]["date"] }}</p>
                        <p><strong>Airline:</strong> {{ dataList[data]["airline"] }}</p>
                        <p><strong>Flight Number:</strong> {{ dataList[data]["flightNumber"] }}</p>

                        <label for="seat_selection">Choose a Seat</label>
                        <div id="wrapper-seat">
                            <button type="button" id="choose_seat" data-seat-2='{{ quadrant_taken_json[data] | tojson | safe }}' data-seat-3='{{ dataList[data]["flightNumber"] }}' onclick="showForm(event, this)">
                                Choose Seat
                            </button>
                            <div id="seating-form">
                                <div id="seats">
                                    <h3 id="seat-form-header">Choose your seat:</h3>
                                    <button type="button" id="closeBtn" onclick="closeForm(event)"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAmdJREFUSEu1lr9uE0EQxn+TuKJLn2dA4g2QFQTCsqCgsEBKSQsFD0QRUkQIWYiOBoGUxijwKoCFiSiG+7N33r3dub2NxBXWeXdv/nzzfTMrDB8BtPmJtvqFaDtx3i355vxT9XviCQ3t/2UCSmcRrnoBgWXPjzob3uBADrQoGwtqK4jovCBoslC+rxbq0egycNhMGNkRpLRqUaA5SA2aeuSyLSTQ3JP+RpG3IBfRZiiJQHQFVTEcu7K3ho4E1iq8QPk+qhjhHspL4DHwdyynXMYHwDfgNvADZA56ZZBxWZ17B8yAD8ByjLWB45DuvSROgdeO+z+BE2DTG20/WgBrhBnKtcBS4WNSMJ0sp9RM4FT3zrcI88rZxkHZOm0zvQYeAJ86mM2yRxuJhaYhCCuUc5f51sF+DFyAzATdKTz0ndaopJtJvV72PAXeuE+2wC3gAOQP6P0Kic9js8V3NaFzRRRZAWcghy6bHcgJ6GVJDpMayCDSlTaOOXTrO0e4y47t6bqGqyarjXn8rMm2teFD/Ru0JtWXpIQSkcRQ2zSvIT4XEKV22mj6GOEClRloxOiQXCHRcg2kmwmhnGAOsnGoLEDWoGVyGjKt7b0BNkYDCU6ZWvabkl++nJzqlvkVuAP8Arkr6FV8JWvM+y3zfdVqH42x3JvHBgNUjgR9W9X1levbwQQJwBEWKM+BJ/GQCMmTy3jkepJgodUfXerhLChR/cjozms3peNuYvTXlCmhW6XxSRcZ7nO/2Z0rLYVwUk6IvejqM1oZP8Hm3TWNaN28c1nmLejKiTKB1QVG7XY7MPKf7tWZ8jZB/AM5t/Em43PHggAAAABJRU5ErkJggg=="/></button>
                                    <div id="column-left-seats" class='{{ dataList[data]["flightNumber"] }}'>
                                        {% for i in range(0, 10) %}
                                            <div id="row-left-seats">
                                                {% for j in range(0, 3) %}
                                                    {% set seat_id = i ~ '-' ~ rowDict[j] %}
                                                    <!-- onclick="sendId('{{ seat_id }}')" -->
                                                    {% if seat_id in taken_seats %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[data] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[data] | tojson | safe }}' data-seat-3='{{ dataList[data]["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn taken">{{ seat_id }}</button>
                                                    {% else %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[data] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[data] | tojson | safe }}' data-seat-3='{{ dataList[data]["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn">{{ seat_id }}</button>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div id="column-right-seats" class='{{ dataList[data]["flightNumber"] }}'>
                                        {% for i in range(0, 10) %}
                                            <div id="row-right-seats">
                                                {% for j in range(3, 6) %}
                                                    {% set seat_id = i ~ '-' ~ rowDict[j] %}
                                                    <!-- onclick="sendId('{{ seat_id }}')" -->
                                                    {% if seat_id in taken_seats %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[data] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[data] | tojson | safe }}' data-seat-3='{{ dataList[data]["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn taken">{{ seat_id }}</button>
                                                    {% else %}
                                                        <button type="button" id="{{ seat_id }}" data-seat-1='{{ taken_seats[data] | tojson | safe }}' data-seat-2='{{ quadrant_taken_json[data] | tojson | safe }}' data-seat-3='{{ dataList[data]["flightNumber"] }}' onclick='processInformation(event, this)' class="seat-btn">{{ seat_id }}</button>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="seat-input" class="seat-input" name="chosen-seat">
                            <p id="chosen-seat-text"></p>
                        </div>
                    </div>
                {% endfor %}
            </div>
            {% endfor %}
            <button type="submit">Submit Booking</button>
        </form>
    </div>
{% endif %}
    <script>
        let flightNumsDict = {};
        // Quadrants and seat disabling logic
        // const quadrantTaken = JSON.parse('{{ quadrant_taken_json | safe }}');
        // const takenSeats = JSON.parse('{{ taken_seats_json | safe }}');
        document.getElementById("form-booking").addEventListener("submit", function(event){
            let seatInput = document.querySelectorAll(".seat-input");
            let hasAlerted = false
            seatInput.forEach((input, index)=>{
                if(!input.value.trim() && !hasAlerted){
                    alert("Please choose a seat!");
                    event.preventDefault();
                    hasAlerted = true
                } else {
                    input.name = `chosen-seat-${index}`
                }
            });
        });
        
        function seatAvailability(quadrantTaken){
            console.log(quadrantTaken)
            const seats = document.querySelectorAll('.seat-btn');
    
            seats.forEach(seat => {
                const seatId = seat.id.trim(); // Ensure no extra spaces in the ID
                const [row, col] = seatId.split('-');
                const rowIndex = parseInt(row, 10); // Convert row to a number
                const colIndex = col.charCodeAt(0) - 'A'.charCodeAt(0); // Map 'A'-'F' to index
                let quadrantX = null;
                let quadrantY = null;
    
                // Assign seats to quadrants
                if (colIndex < 3){
                    quadrantX = 'left';
                } 
                if (colIndex >= 3){
                    quadrantX = 'right';
                } 
                if (rowIndex >= 5) {
                    quadrantY = 'bottom';
                }
                if (rowIndex < 5 && colIndex < 6) {
                    quadrantY = 'top';
                }

                differenceHorizontal = Math.abs(quadrantTaken['left'] - quadrantTaken['right']);
                differenceVertical = Math.abs(quadrantTaken['top'] - quadrantTaken['bottom']);
                // Disable seats if a quadrant has 4 or more taken seats
                // if (quadrant && quadrantTaken[quadrant] >= 4) {
                //     seat.disabled = true;
                //     seat.classList.add('disabled'); // Optional: Add a class for styling
                // }
                switch(quadrantX){
                    case 'left':
                        if(differenceHorizontal >= 3 && quadrantTaken['left'] > quadrantTaken['right']){
                            console.log("left")
                            seat.disabled = true;
                            if (!seat.classList.contains('taken')){
                                seat.classList.add('disabled');
                            }
                        } else {
                            if (differenceVertical < 3){
                                seat.disabled = false;
                                seat.classList.remove('disabled')
                            }
                        }
                        break;
                    default:
                        if(differenceHorizontal >= 3 && quadrantTaken['right'] > quadrantTaken['left']){
                            seat.disabled = true;
                            if (!seat.classList.contains('taken')){
                                seat.classList.add('disabled');
                            }
                        } else {
                            if (differenceVertical < 3){
                                seat.disabled = false;
                                seat.classList.remove('disabled')
                            }
                        }
                        break;
                };
                switch (quadrantY){
                    case 'top':
                        if(differenceVertical >= 3 && quadrantTaken['top'] > quadrantTaken['bottom']){
                            seat.disabled = true;
                            if (!seat.classList.contains('taken')){
                                seat.classList.add('disabled');
                            }
                        } else {
                            if (differenceHorizontal < 3){
                                seat.disabled = false;
                                seat.classList.remove('disabled')
                            }
                        }
                        break;
                    default:
                        if(differenceVertical >= 3 && quadrantTaken['bottom'] > quadrantTaken['top']){
                            seat.disabled = true;
                            if (!seat.classList.contains('taken')){
                                seat.classList.add('disabled');
                            }
                        } else {
                            if (differenceHorizontal < 3){
                                seat.disabled = false;
                                seat.classList.remove('disabled')
                            }
                        }
                        break;
                };
            });
        }

        function removeOldSeats(form, takenSeats, quadrantTaken, flightNum){
            const seats = form.querySelectorAll('.seat-btn');
            const selectedSeatInput = form.querySelector('#seat-input');
            const seatForm = document.querySelectorAll(`[class*="${flightNum}"]`);
            seats.forEach((seat)=>{
                flightNumSeat = seat.getAttribute('data-seat-3');
                if(!takenSeats.hasOwnProperty(seat.id) && seat.classList.contains('taken') && selectedSeatInput.value === seat.id && flightNumSeat == flightNum){
                    seatForm.forEach((f)=>{
                    oldChosen = f.querySelector(`[id="${seat.id}"]`);
                        if (oldChosen) {
                            oldChosen.classList.remove('taken');
                        } else {
                            console.log("Does not exist")
                        }
                    });
                    const [row, col] = seat.id.split('-');
                    const r = parseInt(row, 10);
                    const c = col.charCodeAt(0) - 'A'.charCodeAt(0);
                    let x = null;
                    let y = null;
                    if (c < 3){
                        x = 'left';
                        console.log(x);
                        quadrantTaken.left -= 1;
                    } ;
                    if (c >= 3){
                        x = 'right';
                        console.log(x);
                        quadrantTaken.right -= 1;
                    };
                    if (r >= 5) {
                        y = 'bottom';
                        console.log(y);
                        quadrantTaken.bottom -= 1;
                    };
                    if (r < 5 && c < 6) {
                        y = 'top';
                        console.log(y);
                        quadrantTaken.top -= 1;
                    };
                    return;
                }
            });
        }

        function processInformation(event, button) {
            const takenSeats = JSON.parse(button.getAttribute('data-seat-1'));
            const quadrantTaken = JSON.parse(button.getAttribute('data-seat-2'));
            const flightNum = button.getAttribute('data-seat-3');
            if (!(flightNum in flightNumsDict)){
                flightNumsDict[flightNum] = quadrantTaken;
            }
            seatAvailability(flightNumsDict[flightNum])
            clickedBtn = event.target;
            buttonId = event.target.id;
            const selectedForm = clickedBtn.closest('#wrapper-seat');
            removeOldSeats(selectedForm, takenSeats, flightNumsDict[flightNum], flightNum)
            const [rowChosenSeat, colChosenSeat] = buttonId.split('-');
            const rowNum = parseInt(rowChosenSeat, 10);
            const colNum = colChosenSeat.charCodeAt(0) - 'A'.charCodeAt(0);
            let posX = null;
            let posY = null;

            if (colNum < 3){
                posX = 'left';
                flightNumsDict[flightNum].left += 1;
            } ;
            if (colNum >= 3){
                posX = 'right';
                flightNumsDict[flightNum].right += 1;
            };
            if (rowNum >= 5) {
                posY = 'bottom';
                flightNumsDict[flightNum].bottom += 1;
            };
            if (rowNum < 5 && colNum < 6) {
                posY = 'top';
                flightNumsDict[flightNum].top += 1;
            };
            seatForm = document.querySelectorAll(`[class*="${flightNum}"]`);
            seatForm.forEach((form)=>{
                newChosen = form.querySelector(`[id="${buttonId}"]`);
                if (newChosen) {
                    console.log(newChosen);
                    newChosen.classList.add('taken');
                } else {
                    console.log("Does not exist")
                }
            });
            
            selectedForm.querySelector("#seating-form").style.display = "none";
            const seatText = selectedForm.querySelector("#chosen-seat-text");
            const seatInput = selectedForm.querySelector("#seat-input");
            seatInput.value = buttonId;
            seatText.innerHTML = `You chose seat: ${buttonId}!`;
            seatAvailability(flightNumsDict[flightNum]);
        }

        function showForm(event, button){
            const flightNum = button.getAttribute('data-seat-3');
            if (flightNum in flightNumsDict){   
                seatAvailability(flightNumsDict[flightNum]);
            } else {
                seatAvailability(JSON.parse(button.getAttribute('data-seat-2')))
            };
            btn = event.target;
            const form = btn.closest('#wrapper-seat');
            const closestSeatForm = form.querySelector("#seating-form");
            closestSeatForm.style.display = "flex";
        }

        function closeForm(event){
            btn = event.target;
            const form = btn.closest('#wrapper-seat');
            const closestSeatForm = form.querySelector("#seating-form");
            closestSeatForm.style.display = "none";
        }
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='theme.js') }}"></script>
</body>
</html>
